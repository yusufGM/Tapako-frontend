import{c as E,r as n,j as e,f as F,g as H,d as $,h as K}from"./index-C8HNumvK.js";const _=(r=0)=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Math.max(0,Number(r)||0)).replace(/\s/g,"");function V({open:r,toggle:m,onCreated:b}){const{token:h}=E(),[s,l]=n.useState(""),[u,d]=n.useState(""),[a,i]=n.useState(""),[w,y]=n.useState(""),[j,v]=n.useState(""),[p,k]=n.useState(!1),x=n.useMemo(()=>{const c=Number(a);return s.trim().length>0&&u.trim().length>0&&Number.isFinite(c)&&c>0},[s,u,a]),C=async c=>{if(c.preventDefault(),!(!x||p)){k(!0);try{const f={name:s.trim(),imgSrc:u.trim(),price:Number(a),category:w.trim()||void 0,description:j.trim()||void 0,status:"active"};await $("/admin/items",f,{headers:{Authorization:`Bearer ${h}`}}),l(""),d(""),i(""),y(""),v(""),b?.(),m()}catch(f){alert(f?.payload?.error||"Gagal menambahkan produk")}finally{k(!1)}}};return e.jsxs("div",{className:"bg-white rounded-xl border",children:[e.jsxs("button",{type:"button",onClick:m,className:"w-full flex items-center justify-between px-4 py-3 rounded-t-xl",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Add Product"}),e.jsx("span",{className:`transition-transform ${r?"rotate-180":""}`,children:"▾"})]}),r&&e.jsx("div",{className:"p-4 pt-0",children:e.jsxs("form",{onSubmit:C,className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{value:s,onChange:c=>l(c.target.value),placeholder:"Name",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{value:u,onChange:c=>d(c.target.value),placeholder:"Image URL",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{type:"number",value:a,onChange:c=>i(c.target.value),placeholder:"Price",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{value:w,onChange:c=>y(c.target.value),placeholder:"Category",className:"border rounded px-3 py-2"}),e.jsx("textarea",{value:j,onChange:c=>v(c.target.value),placeholder:"Description",className:"md:col-span-2 border rounded px-3 py-2",rows:3}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{disabled:!x||p,className:"px-4 py-2 rounded bg-black text-white disabled:opacity-50",children:p?"Saving...":"Save Product"})})]})})]})}function O({item:r,onClose:m,onSaved:b}){const{token:h}=E(),[s,l]=n.useState(()=>({name:r?.name||"",imgSrc:r?.imgSrc||"",price:r?.price||0,category:r?.category||"",description:r?.description||"",status:r?.status||"active",version:r?.version??0}));n.useEffect(()=>{l({name:r?.name||"",imgSrc:r?.imgSrc||"",price:r?.price||0,category:r?.category||"",description:r?.description||"",status:r?.status||"active",version:r?.version??0})},[r]);const u=s.name.trim()&&s.imgSrc.trim()&&Number(s.price)>0,d=async a=>{if(a.preventDefault(),!!u)try{await K(`/admin/items/${r._id}`,{name:s.name.trim(),imgSrc:s.imgSrc.trim(),price:Number(s.price),category:s.category.trim()||void 0,description:s.description.trim()||void 0,status:s.status,version:s.version??0},{headers:{Authorization:`Bearer ${h}`}}),b?.(),m?.()}catch(i){alert(i?.payload?.error||"Gagal menyimpan")}};return r?e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("div",{className:"font-semibold",children:"Edit Product"}),e.jsx("button",{onClick:m,className:"px-2 py-1 rounded border",children:"Close"})]}),e.jsxs("form",{onSubmit:d,className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{value:s.name,onChange:a=>l(i=>({...i,name:a.target.value})),placeholder:"Name",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{value:s.imgSrc,onChange:a=>l(i=>({...i,imgSrc:a.target.value})),placeholder:"Image URL",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{type:"number",value:s.price,onChange:a=>l(i=>({...i,price:a.target.value})),placeholder:"Price",className:"border rounded px-3 py-2",required:!0}),e.jsx("input",{value:s.category,onChange:a=>l(i=>({...i,category:a.target.value})),placeholder:"Category",className:"border rounded px-3 py-2"}),e.jsx("textarea",{value:s.description,onChange:a=>l(i=>({...i,description:a.target.value})),placeholder:"Description",className:"md:col-span-2 border rounded px-3 py-2",rows:3}),e.jsxs("select",{value:s.status,onChange:a=>l(i=>({...i,status:a.target.value})),className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"draft",children:"draft"}),e.jsx("option",{value:"archived",children:"archived"})]}),e.jsxs("div",{className:"md:col-span-2 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 rounded border bg-white",children:"Batal"}),e.jsx("button",{disabled:!u,className:"px-4 py-2 rounded bg-black text-white disabled:opacity-50",children:"Simpan"})]})]})]})}):null}function J(){const{token:r}=E(),[m,b]=n.useState(!0),[h,s]=n.useState([]),[l,u]=n.useState(0),[d,a]=n.useState(1),i=15,[w,y]=n.useState(!1),[j,v]=n.useState(""),[p,k]=n.useState("all"),[x,C]=n.useState("updatedDesc"),[c,f]=n.useState(""),[q,M]=n.useState([]),[R,A]=n.useState(null),D=n.useRef(null),N=Math.max(1,Math.ceil(l/i)),L=()=>x==="priceAsc"?"price:asc":x==="priceDesc"?"price:desc":x==="updatedAsc"?"updatedAt:asc":"updatedAt:desc",S=async()=>{y(!0),v("");try{const t=new URLSearchParams({page:String(d),limit:String(i),sort:L()}),o=c.trim();o&&(t.set("q",o),t.set("search",o)),p!=="all"&&t.set("category",p);const g=await F(`/admin/items?${t.toString()}`,{headers:{Authorization:`Bearer ${r}`}}),I=g.items||[];s(I),u(g.total||0);const T=Array.from(new Set(I.map(P=>P.category).filter(Boolean)));M(P=>Array.from(new Set([...P,...T])))}catch(t){v(t?.payload?.error||"Gagal memuat produk")}finally{y(!1)}};n.useEffect(()=>{S()},[d,p,x,c]),n.useEffect(()=>{const t=o=>{o.key==="ArrowRight"&&a(g=>Math.min(N,g+1)),o.key==="ArrowLeft"&&a(g=>Math.max(1,g-1))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[N]);const B=()=>{a(t=>Math.max(1,t-1)),D.current?.scrollIntoView({behavior:"smooth",block:"center"})},G=()=>{a(t=>Math.min(N,t+1)),D.current?.scrollIntoView({behavior:"smooth",block:"center"})},U=async t=>{if(confirm("Hapus item ini?"))try{await H(`/admin/items/${t}`,{headers:{Authorization:`Bearer ${r}`}}),S()}catch(o){alert(o?.payload?.error||"Gagal hapus")}},z=async t=>{try{await $(`/admin/items/${t}/restore`,{},{headers:{Authorization:`Bearer ${r}`}}),S()}catch(o){alert(o?.payload?.error||"Gagal restore")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Products"}),e.jsx(V,{open:m,toggle:()=>b(t=>!t),onCreated:()=>{a(1),S()}}),e.jsx("div",{className:"bg-white rounded-xl border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Cari"}),e.jsx("input",{value:c,onChange:t=>{a(1),f(t.target.value)},placeholder:"Ketik nama produk atau username",className:"border rounded px-3 py-2"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Kategori"}),e.jsxs("select",{value:p,onChange:t=>{a(1),k(t.target.value)},className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"all",children:"Semua"}),q.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Urutkan"}),e.jsxs("select",{value:x,onChange:t=>{a(1),C(t.target.value)},className:"border rounded px-3 py-2",children:[e.jsx("option",{value:"updatedDesc",children:"Ter-update terbaru"}),e.jsx("option",{value:"updatedAsc",children:"Ter-update terlama"}),e.jsx("option",{value:"priceAsc",children:"Harga rendah ke tinggi"}),e.jsx("option",{value:"priceDesc",children:"Harga tinggi ke rendah"})]})]}),e.jsxs("div",{className:"flex items-end text-sm text-gray-600",children:["Menampilkan ",h.length," dari total ",l," item"]})]})}),e.jsxs("div",{className:"border rounded-xl bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Image"}),e.jsx("th",{className:"text-left p-3",children:"Name"}),e.jsx("th",{className:"text-left p-3",children:"Price"}),e.jsx("th",{className:"text-left p-3",children:"Category"}),e.jsx("th",{className:"text-left p-3",children:"Updated"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4",children:"Loading..."})}):j?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-red-600",children:j})}):h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-gray-600",children:"Tidak ada data"})}):h.map(t=>e.jsxs("tr",{className:`border-t ${t.deletedAt?"opacity-60":""}`,children:[e.jsx("td",{className:"p-3",children:e.jsx("img",{src:t.imgSrc,alt:t.name,className:"w-12 h-12 object-cover rounded"})}),e.jsx("td",{className:"p-3",children:t.name}),e.jsx("td",{className:"p-3",children:_(t.price)}),e.jsx("td",{className:"p-3",children:t.category||"-"}),e.jsx("td",{className:"p-3",children:t.updatedAt?new Date(t.updatedAt).toLocaleString("id-ID"):"-"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(t),className:"px-2 py-1 rounded border",children:"Edit"}),t.deletedAt?e.jsx("button",{onClick:()=>z(t._id),className:"px-2 py-1 rounded border",children:"Restore"}):e.jsx("button",{onClick:()=>U(t._id),className:"px-2 py-1 rounded border",children:"Delete"})]})})]},t._id))})]})}),e.jsxs("div",{ref:D,className:"flex items-center justify-between p-3 border-t bg-gray-50",children:[e.jsx("button",{onClick:B,disabled:d<=1,className:"px-3 py-2 rounded border bg-white disabled:opacity-50",children:"‹ Prev"}),e.jsxs("div",{className:"text-sm",children:["Hal ",d," dari ",N]}),e.jsx("button",{onClick:G,disabled:d>=N,className:"px-3 py-2 rounded border bg-white disabled:opacity-50",children:"Next ›"})]})]}),R&&e.jsx(O,{item:R,onClose:()=>A(null),onSaved:()=>{A(null),S()}})]})}export{J as default};
