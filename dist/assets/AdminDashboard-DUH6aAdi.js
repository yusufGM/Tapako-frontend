import{c as w,r as a,j as e,f as g,b}from"./index-C8HNumvK.js";const x=(r=0)=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Math.max(0,Number(r)||0)).replace(/\s/g,"");async function D(r){const d=`${b.baseURL}/admin/orders`,m=`${b.baseURL.replace(/\/api$/,"")}/orders`,i={Authorization:`Bearer ${r}`};let l=await fetch(d,{headers:i});l.status===404&&(l=await fetch(m,{headers:i}));const c=await l.json().catch(()=>[]);if(!l.ok)throw new Error(c?.error||"Gagal memuat orders");return Array.isArray(c)?c:[]}function R(){const{token:r}=w(),[d,m]=a.useState([]),[i,l]=a.useState(0),[c,f]=a.useState([]),[h,y]=a.useState(0),[v,u]=a.useState(!0),[j,p]=a.useState(""),S=async()=>{u(!0),p("");try{const[s,t,n]=await Promise.all([D(r),g("/admin/items?page=1&limit=10&sort=updatedAt:desc",{headers:{Authorization:`Bearer ${r}`}}),g("/admin/stats/customers",{headers:{Authorization:`Bearer ${r}`}})]);m(s),l(t?.total||0),f(t?.items||[]),y(n?.totalUsers||0)}catch(s){p(s?.message||"Gagal memuat dashboard")}finally{u(!1)}};a.useEffect(()=>{S()},[r]);const o=a.useMemo(()=>({totalSales:d.reduce((t,n)=>t+(n.total||0),0),ordersCount:d.length,productsCount:i,registeredCustomers:h}),[d,i,h]),N=a.useMemo(()=>[...d].sort((t,n)=>new Date(n.createdAt)-new Date(t.createdAt)).slice(0,10),[d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Dashboard"}),v?e.jsx("div",{className:"border rounded-xl p-6 animate-pulse",children:"Memuat…"}):j?e.jsx("div",{className:"border rounded-xl p-6 text-red-600",children:j}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Sales"}),e.jsx("div",{className:"text-3xl font-semibold mt-1",children:x(o.totalSales)})]}),e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Orders"}),e.jsx("div",{className:"text-3xl font-semibold mt-1",children:o.ordersCount})]}),e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Products"}),e.jsx("div",{className:"text-3xl font-semibold mt-1",children:o.productsCount})]}),e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Registered Customers"}),e.jsx("div",{className:"text-3xl font-semibold mt-1",children:o.registeredCustomers})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"font-semibold mb-3",children:"Recent Orders"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Waktu"}),e.jsx("th",{className:"text-left p-2",children:"User"}),e.jsx("th",{className:"text-left p-2",children:"Items"}),e.jsx("th",{className:"text-right p-2",children:"Total"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3 text-gray-600",children:"Belum ada order"})}):N.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:new Date(s.createdAt).toLocaleString("id-ID")}),e.jsx("td",{className:"p-2",children:s.username||"-"}),e.jsx("td",{className:"p-2",children:(s.items||[]).map(t=>`${t.name}×${t.qty}`).join(", ")}),e.jsx("td",{className:"p-2 text-right font-semibold",children:x(s.total)})]},s._id))})]})})]}),e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsx("div",{className:"font-semibold mb-3",children:"Recently Updated Products"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Name"}),e.jsx("th",{className:"text-left p-2",children:"Category"}),e.jsx("th",{className:"text-left p-2",children:"Updated"}),e.jsx("th",{className:"text-right p-2",children:"Price"})]})}),e.jsx("tbody",{children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-3 text-gray-600",children:"Tidak ada produk"})}):c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.category||"-"}),e.jsx("td",{className:"p-2",children:s.updatedAt?new Date(s.updatedAt).toLocaleString("id-ID"):"-"}),e.jsx("td",{className:"p-2 text-right",children:x(s.price)})]},s._id))})]})})]})]})]})]})}export{R as default};
