import{a as A,c as E,r as s,j as a}from"./index-BLg1IB1Y.js";const y="https://tapako-backend.vercel.app",k=(r=0)=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Math.max(0,Number(r)||0)).replace(/\s/g,"");function I(){const{cart:r,clearCart:N}=A(),{token:h,username:l,email:o}=E(),[i,b]=s.useState(l||""),[m,x]=s.useState(o||""),[g,j]=s.useState(""),[d,v]=s.useState(""),[c,p]=s.useState(!1);s.useEffect(()=>{l&&!i&&b(l),o&&!m&&x(o)},[l,o]);const f=s.useMemo(()=>r.reduce((e,t)=>e+(Number(t.price)||0)*(Number(t.qty)||0),0),[r]),w=()=>i.trim()?d.trim()?r.length?h?r.some(t=>!t||!t.name||!t.price||!t.qty)?"Terdapat item yang tidak valid pada cart.":null:"Silakan login terlebih dahulu.":"Cart kosong.":"Alamat pengiriman wajib diisi.":"Nama wajib diisi.",C=()=>r.map(e=>({name:e.name,price:Number(e.price)||0,qty:Math.max(1,Number(e.qty)||1)})),S=e=>{const t=e?.paymentUrl||e?.redirect_url||e?.invoice?.invoice_url||e?.data?.invoice_url||e?.url||null;return t?(N(),window.location.assign(t),!0):!1},q=async()=>{const e=w();if(e){alert(e);return}if(c)return;p(!0);const t={items:C(),address:d.trim(),email:m.trim(),whatsapp:g.trim(),username:i.trim(),total:f};try{const n=await fetch(`${y}/checkout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(t)});let u=null;try{u=await n.json()}catch{}if(n.status===401){alert("Sesi login berakhir. Silakan login lagi.");return}if(!n.ok){const P=u?.error||u?.message||`Checkout gagal (HTTP ${n.status}).`;alert(P);return}S(u)||alert("URL pembayaran tidak ditemukan di respons server.")}catch(n){console.error("Checkout error:",n),alert("Terjadi kesalahan saat checkout. Periksa koneksi Anda dan coba lagi.")}finally{p(!1)}};return a.jsxs("div",{className:"max-w-2xl mx-auto px-6 pt-24 pb-10",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Checkout"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block mb-1 font-semibold",children:"Nama"}),a.jsx("input",{type:"text",value:i,onChange:e=>b(e.target.value),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"Nama lengkap",required:!0})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block mb-1 font-semibold",children:"Email"}),a.jsx("input",{type:"email",value:m,onChange:e=>x(e.target.value),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"bob@contoh.com",required:!0})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block mb-1 font-semibold",children:"Nomor WhatsApp"}),a.jsx("input",{type:"tel",inputMode:"numeric",pattern:"0\\\\d{8,15}",value:g,onChange:e=>j(e.target.value.replace(/[^\\d]/g,"")),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"08xxxxxxxxxx",required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 0 di depan, 9–16 digit (contoh: 08**********)"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block mb-1 font-semibold",children:"Alamat Pengiriman"}),a.jsx("textarea",{value:d,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",rows:4,required:!0})]}),a.jsxs("div",{className:"border-t pt-4 mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Ringkasan Pesanan"}),r.length===0?a.jsx("p",{className:"text-sm text-gray-500",children:"Cart kosong."}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-2",children:r.map(e=>a.jsxs("li",{className:"flex justify-between",children:[a.jsxs("span",{children:[e.name," × ",e.qty||1]}),a.jsx("span",{children:k((Number(e.price)||0)*(Number(e.qty)||0))})]},e._id||e.id||`${e.name}-${e.qty}`))}),a.jsxs("div",{className:"mt-4 font-bold text-lg text-right",children:["Total: ",k(f)]})]})]}),a.jsx("button",{onClick:q,disabled:c||!r.length,className:`w-full h-10 text-white rounded transition ${c||!r.length?"bg-black/60 cursor-not-allowed":"bg-black hover:bg-gray-900"}`,children:c?"Memproses...":"Bayar Sekarang"}),a.jsxs("p",{className:"text-xs text-gray-400 mt-3",children:["Endpoint: ",y,"/checkout"]})]})}export{I as default};
