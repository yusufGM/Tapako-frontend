import{r as t,c as k,f as x,j as e,g as v,h as w}from"./index-BLg1IB1Y.js";const C=()=>{const[b,i]=t.useState([]),[g,o]=t.useState([]),[s,r]=t.useState(null),[j,m]=t.useState(!1),[p,u]=t.useState(!1),{token:l}=k(),c=l?{Authorization:`Bearer ${l}`}:{},d=t.useCallback(async()=>{try{m(!0);const a=await x("/items",{headers:{...c}});i(Array.isArray(a)?a:[])}catch(a){console.error("GET /items error:",a),i([])}finally{m(!1)}},[l]),h=t.useCallback(async()=>{try{const a=await x("/orders",{headers:{...c}});o(Array.isArray(a)?a:[])}catch(a){console.error("GET /orders error:",a),o([])}},[l]);t.useEffect(()=>{d(),h()},[d,h]);const y=async a=>{if(confirm("Yakin ingin hapus produk ini?"))try{await v(`/items/${a}`,{headers:{...c}}),d()}catch(n){alert(n?.payload?.error||"Gagal menghapus produk")}},N=async()=>{if(s?._id)try{u(!0);const a={name:s.name,price:Number(s.price)||0,imgSrc:s.imgSrc,description:s.description,category:s.category};await w(`/items/${s._id}`,a,{headers:{...c}}),r(null),d()}catch(a){alert(a?.payload?.error||"Gagal menyimpan perubahan")}finally{u(!1)}};return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto pt-24",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Admin Dashboard"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Semua Produk"}),j?e.jsx("div",{className:"mb-8 p-4 rounded bg-gray-50",children:"Memuat produk…"}):e.jsxs("table",{className:"w-full mb-8 border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2",children:"Nama"}),e.jsx("th",{className:"p-2",children:"Harga"}),e.jsx("th",{className:"p-2",children:"Kategori"}),e.jsx("th",{className:"p-2",children:"Aksi"})]})}),e.jsx("tbody",{children:b.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsxs("td",{className:"p-2",children:["Rp ",Number(a.price||0).toLocaleString("id-ID")]}),e.jsx("td",{className:"p-2",children:a.category}),e.jsxs("td",{className:"p-2 space-x-2",children:[e.jsx("button",{onClick:()=>r(a),className:"px-3 py-1 bg-yellow-500 text-white rounded",children:"Edit"}),e.jsx("button",{onClick:()=>y(a._id),className:"px-3 py-1 bg-red-600 text-white rounded",children:"Hapus"})]})]},a._id))})]}),s&&e.jsxs("div",{className:"mb-8 bg-gray-100 p-4 rounded",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Edit Produk"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"text",value:s.name||"",onChange:a=>r({...s,name:a.target.value}),className:"block w-full p-2 border rounded",placeholder:"Nama"}),e.jsx("input",{type:"number",value:s.price??0,onChange:a=>r({...s,price:Number(a.target.value)}),className:"block w-full p-2 border rounded",placeholder:"Harga"}),e.jsx("input",{type:"text",value:s.imgSrc||"",onChange:a=>r({...s,imgSrc:a.target.value}),className:"block w-full p-2 border rounded md:col-span-2",placeholder:"URL Gambar"}),e.jsx("input",{type:"text",value:s.category||"",onChange:a=>r({...s,category:a.target.value}),className:"block w-full p-2 border rounded",placeholder:"Kategori"}),e.jsx("textarea",{value:s.description||"",onChange:a=>r({...s,description:a.target.value}),className:"block w-full p-2 border rounded md:col-span-2",rows:3,placeholder:"Deskripsi"})]}),e.jsxs("div",{className:"mt-3 space-x-2",children:[e.jsx("button",{onClick:N,className:"bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-60",disabled:p,children:p?"Menyimpan…":"Simpan"}),e.jsx("button",{onClick:()=>r(null),className:"bg-gray-300 text-gray-900 px-4 py-2 rounded",children:"Batal"})]})]}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Riwayat Pesanan"}),e.jsxs("table",{className:"w-full border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2",children:"User"}),e.jsx("th",{className:"p-2",children:"Item"})]})}),e.jsx("tbody",{children:g.map(a=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:a.username||a.user}),e.jsx("td",{className:"p-2",children:a.items?.map((n,f)=>e.jsxs("div",{children:[n.name," - Rp ",Number(n.price||0).toLocaleString("id-ID")]},f))})]},a._id))})]})]})};export{C as default};
