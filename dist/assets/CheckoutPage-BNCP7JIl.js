import{a as A,c as E,r as t,j as e}from"./index-BijxPbYG.js";const j="https://tapako-backend.vercel.app",y=(s=0)=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Math.max(0,Number(s)||0)).replace(/\s/g,"");function I(){const{cart:s,clearCart:N}=A(),{token:h,username:l,email:i}=E(),[o,x]=t.useState(l||""),[m,p]=t.useState(i||""),[b,k]=t.useState(""),[u,v]=t.useState(""),[c,g]=t.useState(!1);t.useEffect(()=>{l&&!o&&x(l),i&&!m&&p(i)},[l,i]);const f=t.useMemo(()=>s.reduce((a,r)=>a+(Number(r.price)||0)*(Number(r.qty)||0),0),[s]),w=()=>o.trim()?u.trim()?s.length?h?s.some(r=>!r||!r.name||!r.price||!r.qty)?"Terdapat item yang tidak valid pada cart.":null:"Silakan login terlebih dahulu.":"Cart kosong.":"Alamat pengiriman wajib diisi.":"Nama wajib diisi.",C=()=>s.map(a=>({name:a.name,price:Number(a.price)||0,qty:Math.max(1,Number(a.qty)||1)})),S=a=>{const r=a?.paymentUrl||a?.redirect_url||a?.invoice?.invoice_url||a?.data?.invoice_url||a?.url||null;return r?(N(),window.location.assign(r),!0):!1},q=async()=>{const a=w();if(a){alert(a);return}if(c)return;g(!0);const r={items:C(),address:u.trim(),email:m.trim(),whatsapp:b.trim(),username:o.trim(),total:f};try{const n=await fetch(`${j}/checkout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(r)});let d=null;try{d=await n.json()}catch{}if(n.status===401){alert("Sesi login berakhir. Silakan login lagi.");return}if(!n.ok){const P=d?.error||d?.message||`Checkout gagal (HTTP ${n.status}).`;alert(P);return}S(d)||alert("URL pembayaran tidak ditemukan di respons server.")}catch(n){console.error("Checkout error:",n),alert("Terjadi kesalahan saat checkout. Periksa koneksi Anda dan coba lagi.")}finally{g(!1)}};return e.jsxs("div",{className:"max-w-5xl mx-auto px-6 pt-24 pb-10",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Checkout"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Nama"}),e.jsx("input",{type:"text",value:o,onChange:a=>x(a.target.value),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"Nama lengkap",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Email"}),e.jsx("input",{type:"email",value:m,onChange:a=>p(a.target.value),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"contoh@email.com",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Nomor WhatsApp"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"0\\\\d{8,15}",value:b,onChange:a=>k(a.target.value.replace(/\D/g,"")),className:"w-full h-10 px-3 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",placeholder:"08xxxxxxxxxx",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: 0 di depan, 9–16 digit (contoh: 08**********)"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Alamat Pengiriman"}),e.jsx("textarea",{value:u,onChange:a=>v(a.target.value),className:"w-full px-3 py-2 border border-gray-400 rounded focus:outline-none focus:ring-1 focus:ring-black",rows:4,required:!0})]})]}),e.jsx("aside",{className:"md:pl-4",children:e.jsx("div",{className:"sticky top-24",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Ringkasan Pesanan"}),s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Cart kosong."}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-2 max-h-72 overflow-auto pr-1",children:s.map(a=>e.jsxs("li",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a.name," × ",a.qty||1]}),e.jsx("span",{children:y((Number(a.price)||0)*(Number(a.qty)||0))})]},a._id||a.id||`${a.name}-${a.qty}`))}),e.jsxs("div",{className:"mt-4 flex justify-between font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:y(f)})]}),e.jsx("button",{onClick:q,disabled:c||!s.length,className:`mt-4 w-full h-10 text-white rounded transition ${c||!s.length?"bg-black/60 cursor-not-allowed":"bg-black hover:bg-gray-900"}`,children:c?"Memproses...":"Bayar Sekarang"}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-2",children:["Endpoint: ",j,"/checkout"]})]})]})})})]})]})}export{I as default};
