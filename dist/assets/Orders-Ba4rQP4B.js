import{c as $,r as a,j as e,b as D}from"./index-C8HNumvK.js";const C=(r=0)=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Math.max(0,Number(r)||0)).replace(/\s/g,"");function A(r,s=400){const[c,o]=a.useState(r);return a.useEffect(()=>{const d=setTimeout(()=>o(r),s);return()=>clearTimeout(d)},[r,s]),c}async function E({token:r,params:s}){const c=s.toString()?`?${s.toString()}`:"",o=`${D.baseURL}/admin/orders${c}`,d=`${D.baseURL.replace(/\/api$/,"")}/orders${c}`,x={Authorization:`Bearer ${r}`};let n=await fetch(o,{headers:x});n.status===404&&(n=await fetch(d,{headers:x}));const l=await n.json().catch(()=>[]);if(!n.ok)throw new Error(l?.error||"Gagal memuat orders");return Array.isArray(l)?l:[]}function I(){const{token:r}=$(),[s,c]=a.useState([]),[o,d]=a.useState(!0),[x,n]=a.useState(null),[l,j]=a.useState(""),[m,y]=a.useState(""),[N,v]=a.useState(""),h=A(N,400),M=new Date().getTimezoneOffset(),[u,p]=a.useState(1),g=15,w=async()=>{d(!0),n(null);try{const t=new URLSearchParams;l&&t.set("from",l),m&&t.set("to",m),h&&t.set("username",h),t.set("tz",String(M));const i=await E({token:r,params:t});c(i),p(1)}catch(t){n(t.message)}finally{d(!1)}};a.useEffect(()=>{w()},[l,m,h,r]);const S=a.useMemo(()=>{const t=s.reduce((i,f)=>i+(f.total||0),0);return{count:s.length,total:t}},[s]),b=Math.max(1,Math.ceil((s.length||0)/g)),k=(u-1)*g,T=s.slice(k,k+g),R=()=>{j(""),y(""),v("")};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Orders"}),e.jsxs("div",{className:"bg-white rounded-xl border p-4 grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Dari Tanggal"}),e.jsx("input",{type:"date",value:l,onChange:t=>j(t.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Sampai Tanggal"}),e.jsx("input",{type:"date",value:m,onChange:t=>y(t.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{className:"flex flex-col md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1",children:"Cari Username"}),e.jsx("input",{value:N,onChange:t=>v(t.target.value),placeholder:"mis. tapako",className:"border rounded px-2 py-1"})]}),e.jsxs("div",{className:"md:col-span-4 flex gap-2 justify-end",children:[e.jsxs("div",{className:"px-3 py-1 rounded border bg-white text-sm self-center mr-auto",children:[S.count," order • Total ",C(S.total)]}),e.jsx("button",{onClick:R,className:"px-3 py-2 rounded border bg-white hover:bg-gray-50",children:"Reset"}),e.jsx("button",{onClick:w,className:"px-3 py-2 rounded bg-black text-white",children:"Terapkan"})]})]}),o?e.jsx("div",{className:"border rounded-xl p-6 animate-pulse",children:"Memuat…"}):x?e.jsx("div",{className:"border rounded-xl p-6 text-red-600",children:x}):T.length===0?e.jsx("div",{className:"border rounded-xl p-6 text-gray-600",children:"Tidak ada order untuk filter saat ini."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Waktu"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Username"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Alamat"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"})]})}),e.jsx("tbody",{children:T.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:new Date(t.createdAt).toLocaleString("id-ID")}),e.jsx("td",{className:"px-4 py-3",children:t.username||"-"}),e.jsx("td",{className:"px-4 py-3 max-w-[280px] truncate",title:t.address,children:t.address||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("ul",{className:"list-disc pl-5",children:(t.items||[]).map((i,f)=>e.jsxs("li",{children:[i.name," × ",i.qty]},f))})}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:C(t.total)}),e.jsx("td",{className:"px-4 py-3",children:t.status})]},t._id))})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-xl bg-gray-50",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(1,t-1)),disabled:u<=1,className:"px-3 py-2 rounded border bg-white disabled:opacity-50",children:"‹ Prev"}),e.jsxs("div",{className:"text-sm",children:["Hal ",u," dari ",b," • ",s.length," orders"]}),e.jsx("button",{onClick:()=>p(t=>Math.min(b,t+1)),disabled:u>=b,className:"px-3 py-2 rounded border bg-white disabled:opacity-50",children:"Next ›"})]})]})]})}export{I as default};
